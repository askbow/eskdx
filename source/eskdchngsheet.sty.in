% Copyright 2006 Konstantin Korikov <lostclus@ua.fm>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2003/12/01 or later.
%
% This work has the LPPL maintenance status "maintained".
% 
% This Current Maintainer of this work is Konstantin Korikov.
%
% This work consists of all files listed in manifest.txt.
%
m4_ESKDX_INIT
m4_FILE_INIT
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{eskdchngsheet}[m4_dnl
m4_FILE_ID([[$Date::                            $]]) Sheet of Changes GOST 2.503-90]

\RequirePackage{eskdlang}
\RequirePackage{eskdstamp}
\RequirePackage{array}
\RequirePackage{longtable}
\RequirePackage{multirow}

%TODO подогнать размер \arraystretch под 5мм
% совершенно не понятно, почему надо вычитать 3\tabcolsep
% сделать размер ячеек таблицы независимым от текущего шрифта

\newenvironment{ESKDchangeSheet}{%
\renewcommand{\arraystretch}{0.6}
\begin{ESKDzeroPadding}
\ESKDclearDoublePage
\setlength{\tabcolsep}{0.5mm}

\newlength{\ESKDchngColumnIwidth}
  \setlength{\ESKDchngColumnIwidth}{8mm}
\newlength{\ESKDchngColumnIIwidth}
  \setlength{\ESKDchngColumnIIwidth}{20mm}
\newlength{\ESKDchngColumnIIIwidth}
  \setlength{\ESKDchngColumnIIIwidth}{20mm}
\newlength{\ESKDchngColumnIVwidth}
  \setlength{\ESKDchngColumnIVwidth}{20mm}
\newlength{\ESKDchngColumnVwidth}
  \setlength{\ESKDchngColumnVwidth}{20mm}
\newlength{\ESKDchngColumnVIwidth}
  \setlength{\ESKDchngColumnVIwidth}{20mm}
\newlength{\ESKDchngColumnVIIwidth}
  \setlength{\ESKDchngColumnVIIwidth}{20mm}
\newlength{\ESKDchngColumnVIIIwidth}
  \setlength{\ESKDchngColumnVIIIwidth}{20mm}
\newlength{\ESKDchngColumnIXwidth}
  \setlength{\ESKDchngColumnIXwidth}{15mm}
\newlength{\ESKDchngColumnXwidth}
  \setlength{\ESKDchngColumnXwidth}{10mm}

\noindent
\begin{longtable}{%
  |p{\ESKDchngColumnIwidth}
  |p{\ESKDchngColumnIIwidth}
  |p{\ESKDchngColumnIIIwidth}
  |p{\ESKDchngColumnIVwidth}
  |p{\ESKDchngColumnVwidth}
  |p{\ESKDchngColumnVIwidth}
  |p{\ESKDchngColumnVIIwidth}
  |p{\ESKDchngColumnVIIIwidth}
  |p{\ESKDchngColumnIXwidth}
  |p{\ESKDchngColumnXwidth}}
\hline
\multicolumn{10}{|c}
  {\parbox[c][10mm][c]{\textwidth -8\tabcolsep}
    {\centering\ESKDfontTabHead\ESKDchangeSheetName}}\\\hline

\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnIname}}&
\multicolumn{4}{c|}
  {\ESKDfontTabHead\ESKDchngColumnsIIhName}&
\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnVIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnVIname}}&
\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnVIIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnVIIname}}&
\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnVIIIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnVIIIname}}&
\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnIXwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnIXname}}&
\multirow{5}{*}
  {\parbox[c]{\ESKDchngColumnXwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnXname}}\\\cline{2-5}

&\multirow{4}{*}
  {\parbox[c]{\ESKDchngColumnIIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnIIname}}&
\multirow{4}{*}
  {\parbox[c]{\ESKDchngColumnIIIwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnIIIname}}&
\multirow{4}{*}
  {\parbox[c]{\ESKDchngColumnIVwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnIVname}}&
\multirow{4}{*}
  {\parbox[c]{\ESKDchngColumnVwidth}
    {\centering\ESKDfontTabHead\ESKDchngColumnVname}}&&&&\\

&&&&&&&&\\
&&&&&&&&\\
&&&&&&&&\\\hline
\endfirsthead
\endhead
\hline
\endfoot}%
{\end{longtable}\end{ESKDzeroPadding}
\renewcommand{\arraystretch}{1}}

m4_dnl vim:ft=tex:sw=2:ai
